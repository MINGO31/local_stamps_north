<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ºç£åŒ—éƒ¨åœ°å€ & æ³¨éŸ³ç¬¦è™Ÿéƒµç¥¨é…å°éŠæˆ²</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* è‡ªå®šç¾©æ¨£å¼ */
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
        /* æ‹–æ›³ä¸­çš„éƒµç¥¨æ¨£å¼ */
        .dragging {
            opacity: 0.5;
            transform: scale(1.1);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        /* æ”¾ç½®å€çš„æç¤ºæ¨£å¼ */
        .drop-zone-hover {
            background-color: #fef9c3; /* yellow-100 */
            border-color: #facc15; /* yellow-400 */
        }
        /* æ­£ç¢ºç­”æ¡ˆçš„æ¨£å¼ */
        .correct {
            border-color: #4ade80; /* green-400 */
            box-shadow: 0 0 10px #4ade80;
        }
        /* éŒ¯èª¤ç­”æ¡ˆçš„æ¨£å¼ */
        .incorrect {
            border-color: #f87171; /* red-400 */
            box-shadow: 0 0 10px #f87171;
        }
        /* çµ±ä¸€å®šç¾©æ”¾ç½®å€å¡Šçš„å®šä½èˆ‡ç½®ä¸­ */
        .drop-zone {
            position: absolute;
            transform: translate(-50%, -50%);
            /* æ ¡æ­£æ¨¡å¼ä¸‹çš„æ¨£å¼ */
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        /* æ”¾ç½®å€çš„ä½ç½®ï¼Œä½¿ç”¨çµ•å°å®šä½ (å·²å¾®èª¿å°é½Š) */
        #renai    { top: 20%; left: 78.5%; }
        #jinshan  { top: 16.5%; left: 63.5%; }
        #sanzhi   { top: 24%; left: 43%; }
        #tamsui   { top: 38%; left: 35%; }
        #beitou   { top: 31%; left: 51.5%; }
        #shilin   { top: 41%; left: 57.5%; }
        #zhongshan{ top: 47%; left: 67.5%; }
        #luzhu    { top: 56%; left: 30%; }
        #dayuan   { top: 66%; left: 20%; }
        #hukou    { top: 76%; left: 45%; }
        #zhubei   { top: 86%; left: 54.5%; }
        #zhunan   { top: 91%; left: 36%; }
        
        /* æ ¡æ­£æ¨¡å¼å°ˆç”¨æ¨£å¼ */
        .correction-mode .drop-zone {
            cursor: move;
            border-color: #3b82f6; /* blue-500 */
            box-shadow: 0 0 10px #3b82f6;
            z-index: 10;
        }
        .correction-mode .drop-zone .coords {
            display: block;
        }
        .coords {
            display: none;
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 2px 5px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            pointer-events: none; /* è®“æ»‘é¼ å¯ä»¥ç©¿é€æ­¤å…ƒç´  */
        }
    </style>
</head>
<body class="bg-blue-50 flex flex-col items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-5xl mx-auto bg-white rounded-2xl shadow-lg p-4 sm:p-8">
        <header class="flex flex-col md:flex-row justify-between items-start gap-4 mb-4">
            <div class="text-left">
                <h1 class="text-2xl sm:text-3xl font-bold text-blue-800">è‡ºç£åŒ—éƒ¨åœ°å€ & éƒµç¥¨é…å°éŠæˆ²</h1>
                <p class="text-gray-600 mt-2">è«‹å°‡ä¸‹æ–¹çš„éƒµç¥¨ï¼Œæ‹–æ›³åˆ°åœ°åœ–ä¸Šå°æ‡‰çš„é„‰é®å¸‚å€æ¡†ä¸­ã€‚</p>
            </div>
            <!-- æ™¯é»è³‡è¨Šé¡¯ç¤ºå€ (å·²ä¸Šç§») -->
            <div id="info-box" class="w-full md:w-1/3 p-4 bg-yellow-50 border-2 border-yellow-200 rounded-lg h-32 flex items-center justify-center shrink-0">
                <p id="info-text" class="text-center text-yellow-800"></p>
            </div>
        </header>

        <!-- æ§åˆ¶æŒ‰éˆ•å€ -->
        <div id="controls-area" class="mb-6 w-full flex flex-col md:flex-row justify-between items-center gap-4">
            <!-- å·¦å´æŒ‰éˆ• -->
            <div class="flex gap-4 flex-wrap justify-center md:justify-start">
                 <button id="check-button" class="px-6 py-3 bg-blue-600 text-white font-bold rounded-lg shadow-md hover:bg-blue-700 transition-colors duration-300">æª¢æŸ¥ç­”æ¡ˆ</button>
                 <button id="reset-button" class="px-6 py-3 bg-gray-500 text-white font-bold rounded-lg shadow-md hover:bg-gray-600 transition-colors duration-300">é‡æ–°é–‹å§‹</button>
                 <button id="correction-toggle-btn" class="px-4 py-3 bg-purple-600 text-white font-bold rounded-lg shadow-md hover:bg-purple-700 transition-colors duration-300">é–‹å•Ÿæ ¡æ­£æ¨¡å¼</button>
            </div>
            <!-- å³å´è¨ˆæ•¸å™¨èˆ‡è¨Šæ¯ -->
            <div class="flex items-center gap-4 h-8">
                <p id="result-message" class="text-lg font-bold"></p>
                <span id="correct-counter" class="font-bold text-green-600"></span>
                <span id="incorrect-counter" class="font-bold text-red-600"></span>
            </div>
        </div>


        <main class="flex flex-col lg:flex-row gap-8">
            <!-- åœ°åœ–å€åŸŸ -->
            <div class="map-area relative w-full lg:w-2/3 h-[350px] sm:h-[500px] bg-gray-100 rounded-lg overflow-hidden flex items-center justify-center">
                <img src="https://raw.githubusercontent.com/MINGO31/local_stamps_north/refs/heads/main/game4_assets/north_map.png" alt="å°ç£åŒ—éƒ¨åœ°åœ–" class="max-w-full max-h-full">
                
                <!-- æ”¾ç½®å€ -->
                <div id="renai" data-answer="ã„–" class="drop-zone w-16 h-16 sm:w-20 sm:h-20 bg-white/70 border-2 border-dashed border-gray-400 rounded-md flex items-center justify-center transition-all duration-200"><span class="coords"></span></div>
                <div id="jinshan" data-answer="ã„" class="drop-zone w-16 h-16 sm:w-20 sm:h-20 bg-white/70 border-2 border-dashed border-gray-400 rounded-md flex items-center justify-center transition-all duration-200"><span class="coords"></span></div>
                <div id="sanzhi" data-answer="ã„™" class="drop-zone w-16 h-16 sm:w-20 sm:h-20 bg-white/70 border-2 border-dashed border-gray-400 rounded-md flex items-center justify-center transition-all duration-200"><span class="coords"></span></div>
                <div id="tamsui" data-answer="ã„‰" class="drop-zone w-16 h-16 sm:w-20 sm:h-20 bg-white/70 border-2 border-dashed border-gray-400 rounded-md flex items-center justify-center transition-all duration-200"><span class="coords"></span></div>
                <div id="beitou" data-answer="ã„…" class="drop-zone w-16 h-16 sm:w-20 sm:h-20 bg-white/70 border-2 border-dashed border-gray-400 rounded-md flex items-center justify-center transition-all duration-200"><span class="coords"></span></div>
                <div id="shilin" data-answer="ã„•" class="drop-zone w-16 h-16 sm:w-20 sm:h-20 bg-white/70 border-2 border-dashed border-gray-400 rounded-md flex items-center justify-center transition-all duration-200"><span class="coords"></span></div>
                <div id="zhongshan" data-answer="ã„“" class="drop-zone w-16 h-16 sm:w-20 sm:h-20 bg-white/70 border-2 border-dashed border-gray-400 rounded-md flex items-center justify-center transition-all duration-200"><span class="coords"></span></div>
                <div id="luzhu" data-answer="ã„Œ" class="drop-zone w-16 h-16 sm:w-20 sm:h-20 bg-white/70 border-2 border-dashed border-gray-400 rounded-md flex items-center justify-center transition-all duration-200"><span class="coords"></span></div>
                <div id="dayuan" data-answer="ã„‰" class="drop-zone w-16 h-16 sm:w-20 sm:h-20 bg-white/70 border-2 border-dashed border-gray-400 rounded-md flex items-center justify-center transition-all duration-200"><span class="coords"></span></div>
                <div id="hukou" data-answer="ã„" class="drop-zone w-16 h-16 sm:w-20 sm:h-20 bg-white/70 border-2 border-dashed border-gray-400 rounded-md flex items-center justify-center transition-all duration-200"><span class="coords"></span></div>
                <div id="zhubei" data-answer="ã„“" class="drop-zone w-16 h-16 sm:w-20 sm:h-20 bg-white/70 border-2 border-dashed border-gray-400 rounded-md flex items-center justify-center transition-all duration-200"><span class="coords"></span></div>
                <div id="zhunan" data-answer="ã„“" class="drop-zone w-16 h-16 sm:w-20 sm:h-20 bg-white/70 border-2 border-dashed border-gray-400 rounded-md flex items-center justify-center transition-all duration-200"><span class="coords"></span></div>
            </div>

            <!-- å³å´å€åŸŸ -->
            <div id="right-panel" class="w-full lg:w-1/3 flex flex-col gap-4">
                <!-- éƒµç¥¨å€ -->
                <div id="stamp-box" class="p-4 bg-blue-100 border-2 border-blue-200 rounded-lg">
                    <h2 class="text-lg font-bold text-center text-blue-700 mb-4">éƒµç¥¨å€</h2>
                    <div id="stamp-collection" class="grid grid-cols-3 gap-4 place-items-center">
                        <div class="stamp w-16 h-16 sm:w-20 sm:h-20 bg-white rounded-lg shadow-md cursor-grab" draggable="true" data-zhuyin="ã„–" data-info="åŸºéš†å¸‚ä»æ„›å€ï¼Œæ˜¯åŸºéš†å¸‚æ”¿åºœçš„æ‰€åœ¨åœ°ï¼Œæ“æœ‰ç†±é¬§çš„å»Ÿå£å¤œå¸‚ã€‚"><img src="https://raw.githubusercontent.com/MINGO31/local_stamps_north/refs/heads/main/game4_assets/stamp1.jpg" alt="éƒµç¥¨ ã„–" class="w-full h-full object-cover rounded-lg"></div>
                        <div class="stamp w-16 h-16 sm:w-20 sm:h-20 bg-white rounded-lg shadow-md cursor-grab" draggable="true" data-zhuyin="ã„" data-info="æ–°åŒ—å¸‚é‡‘å±±å€ï¼Œä»¥é‡‘å±±è€è¡—å’Œæº«æ³‰èåï¼Œæ˜¯åŒ—æµ·å²¸çš„è§€å…‰ç†±é»ã€‚"><img src="https://raw.githubusercontent.com/MINGO31/local_stamps_north/refs/heads/main/game4_assets/stamp2.jpg" alt="éƒµç¥¨ ã„" class="w-full h-full object-cover rounded-lg"></div>
                        <div class="stamp w-16 h-16 sm:w-20 sm:h-20 bg-white rounded-lg shadow-md cursor-grab" draggable="true" data-zhuyin="ã„™" data-info="æ–°åŒ—å¸‚ä¸‰èŠå€ï¼Œæ˜¯å‰ç¸½çµ±æç™»è¼çš„æ•…é„‰ï¼Œæœ‰ç¾éº—çš„æ·ºæ°´ç£æµ·ç˜ã€‚"><img src="https://raw.githubusercontent.com/MINGO31/local_stamps_north/refs/heads/main/game4_assets/stamp3.jpg" alt="éƒµç¥¨ ã„™" class="w-full h-full object-cover rounded-lg"></div>
                        <div class="stamp w-16 h-16 sm:w-20 sm:h-20 bg-white rounded-lg shadow-md cursor-grab" draggable="true" data-zhuyin="ã„‰" data-info="æ–°åŒ—å¸‚æ·¡æ°´å€ï¼Œæ“æœ‰è±å¯Œçš„æ­·å²å¤è¹Ÿå’Œè¿·äººçš„æ·¡æ°´æ²³å²¸æ™¯è§€ã€‚"><img src="https://raw.githubusercontent.com/MINGO31/local_stamps_north/refs/heads/main/game4_assets/stamp4.jpg" alt="éƒµç¥¨ ã„‰" class="w-full h-full object-cover rounded-lg"></div>
                        <div class="stamp w-16 h-16 sm:w-20 sm:h-20 bg-white rounded-lg shadow-md cursor-grab" draggable="true" data-zhuyin="ã„…" data-info="è‡ºåŒ—å¸‚åŒ—æŠ•å€ï¼Œä»¥å…¶åœ°ç†±è°·å’Œæº«æ³‰æ—…é¤¨è€Œèåéé‚‡ã€‚"><img src="https://raw.githubusercontent.com/MINGO31/local_stamps_north/refs/heads/main/game4_assets/stamp5.jpg" alt="éƒµç¥¨ ã„…" class="w-full h-full object-cover rounded-lg"></div>
                        <div class="stamp w-16 h-16 sm:w-20 sm:h-20 bg-white rounded-lg shadow-md cursor-grab" draggable="true" data-zhuyin="ã„•" data-info="è‡ºåŒ—å¸‚å£«æ—å€ï¼Œæ•…å®®åšç‰©é™¢å’Œå£«æ—å¤œå¸‚æ˜¯é€™è£¡æœ€è‘—åçš„åœ°æ¨™ã€‚"><img src="https://raw.githubusercontent.com/MINGO31/local_stamps_north/refs/heads/main/game4_assets/stamp6.jpg" alt="éƒµç¥¨ ã„•" class="w-full h-full object-cover rounded-lg"></div>
                        <div class="stamp w-16 h-16 sm:w-20 sm:h-20 bg-white rounded-lg shadow-md cursor-grab" draggable="true" data-zhuyin="ã„“" data-info="è‡ºåŒ—å¸‚ä¸­å±±å€ï¼Œå•†æ¥­æ´»å‹•é »ç¹ï¼Œæ“æœ‰è¨±å¤šé‡‘èæ©Ÿæ§‹å’Œç™¾è²¨å…¬å¸ã€‚"><img src="https://raw.githubusercontent.com/MINGO31/local_stamps_north/refs/heads/main/game4_assets/stamp7.jpg" alt="éƒµç¥¨ ã„“" class="w-full h-full object-cover rounded-lg"></div>
                        <div class="stamp w-16 h-16 sm:w-20 sm:h-20 bg-white rounded-lg shadow-md cursor-grab" draggable="true" data-zhuyin="ã„Œ" data-info="æ¡ƒåœ’å¸‚è˜†ç«¹å€ï¼Œé„°è¿‘æ¡ƒåœ’åœ‹éš›æ©Ÿå ´ï¼Œæ˜¯èˆªç©ºè²¨é‹çš„é‡è¦åŸºåœ°ã€‚"><img src="https://raw.githubusercontent.com/MINGO31/local_stamps_north/refs/heads/main/game4_assets/stamp8.jpg" alt="éƒµç¥¨ ã„Œ" class="w-full h-full object-cover rounded-lg"></div>
                        <div class="stamp w-16 h-16 sm:w-20 sm:h-20 bg-white rounded-lg shadow-md cursor-grab" draggable="true" data-zhuyin="ã„" data-info="æ–°ç«¹ç¸£æ¹–å£é„‰ï¼Œä»¥æ¹–å£è€è¡—çš„ç‰Œæ¨“å»ºç¯‰å’Œè»äº‹åŸºåœ°ç‚ºç‰¹è‰²ã€‚"><img src="https://raw.githubusercontent.com/MINGO31/local_stamps_north/refs/heads/main/game4_assets/stamp9.jpg" alt="éƒµç¥¨ ã„" class="w-full h-full object-cover rounded-lg"></div>
                        <div class="stamp w-16 h-16 sm:w-20 sm:h-20 bg-white rounded-lg shadow-md cursor-grab" draggable="true" data-zhuyin="ã„‡" data-info="é€™æ˜¯ä¸€å€‹å¹²æ“¾é¸é …ï¼Œè«‹å°‹æ‰¾æ­£ç¢ºçš„é…å°ï¼"><img src="https://raw.githubusercontent.com/MINGO31/local_stamps_north/refs/heads/main/game4_assets/stamp10.jpg" alt="éƒµç¥¨ ã„‡" class="w-full h-full object-cover rounded-lg"></div>
                        <div class="stamp w-16 h-16 sm:w-20 sm:h-20 bg-white rounded-lg shadow-md cursor-grab" draggable="true" data-zhuyin="ã„Š" data-info="é€™æ˜¯ä¸€å€‹å¹²æ“¾é¸é …ï¼Œè«‹å°‹æ‰¾æ­£ç¢ºçš„é…å°ï¼"><img src="https://raw.githubusercontent.com/MINGO31/local_stamps_north/refs/heads/main/game4_assets/stamp11.jpg" alt="éƒµç¥¨ ã„Š" class="w-full h-full object-cover rounded-lg"></div>
                        <div class="stamp w-16 h-16 sm:w-20 sm:h-20 bg-white rounded-lg shadow-md cursor-grab" draggable="true" data-zhuyin="ã„" data-info="é€™æ˜¯ä¸€å€‹å¹²æ“¾é¸é …ï¼Œè«‹å°‹æ‰¾æ­£ç¢ºçš„é…å°ï¼"><img src="https://raw.githubusercontent.com/MINGO31/local_stamps_north/refs/heads/main/game4_assets/stamp12.jpg" alt="éƒµç¥¨ ã„" class="w-full h-full object-cover rounded-lg"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // éŠæˆ²ä¸»è¦å…ƒç´ 
            const stamps = document.querySelectorAll('.stamp');
            const dropZones = document.querySelectorAll('.drop-zone');
            const stampCollection = document.getElementById('stamp-collection');
            const checkButton = document.getElementById('check-button');
            const resetButton = document.getElementById('reset-button');
            const resultMessage = document.getElementById('result-message');
            const correctCounter = document.getElementById('correct-counter');
            const incorrectCounter = document.getElementById('incorrect-counter');
            const infoText = document.getElementById('info-text');
            
            // æ ¡æ­£æ¨¡å¼ç›¸é—œå…ƒç´ 
            const correctionToggleButton = document.getElementById('correction-toggle-btn');
            const gameContainer = document.querySelector('.w-full.max-w-5xl');
            const mapArea = document.querySelector('.map-area');
            let isCorrectionMode = false;
            let activeZone = null;
            let offsetX, offsetY;

            // --- éŠæˆ²æ ¸å¿ƒé‚è¼¯ ---
            let draggedStamp = null;

            stamps.forEach(stamp => {
                stamp.addEventListener('dragstart', (e) => {
                    if (isCorrectionMode) {
                        e.preventDefault();
                        return;
                    }
                    draggedStamp = e.target.closest('.stamp');
                    setTimeout(() => {
                        draggedStamp.classList.add('dragging');
                    }, 0);
                    // æ‹¿èµ·æ–°éƒµç¥¨æ™‚æ¸…ç©ºè³‡è¨Š
                    infoText.textContent = '';
                    infoText.parentElement.classList.remove('bg-red-50', 'border-red-200');
                    infoText.classList.remove('text-red-800');
                });
                stamp.addEventListener('dragend', (e) => {
                    if (draggedStamp) {
                       draggedStamp.classList.remove('dragging');
                    }
                });
            });

            dropZones.forEach(zone => {
                zone.addEventListener('dragover', (e) => {
                    if (isCorrectionMode) return;
                    e.preventDefault();
                    zone.classList.add('drop-zone-hover');
                });
                zone.addEventListener('dragleave', () => {
                    if (isCorrectionMode) return;
                    zone.classList.remove('drop-zone-hover');
                });
                zone.addEventListener('drop', (e) => {
                    if (isCorrectionMode) return;
                    e.preventDefault();
                    zone.classList.remove('drop-zone-hover');
                    const existingStamp = zone.querySelector('.stamp');
                    if (existingStamp) {
                        stampCollection.appendChild(existingStamp);
                    }
                    zone.appendChild(draggedStamp);

                    // --- å³æ™‚è³‡è¨Šé¡¯ç¤ºé‚è¼¯ ---
                    const isCorrect = draggedStamp.dataset.zhuyin === zone.dataset.answer;
                    if(isCorrect) {
                        // æ³¨æ„ï¼šæ·¡æ°´å’Œå¤§åœ’çš„æ³¨éŸ³éƒ½æ˜¯ 'ã„‰'ï¼Œä½†éƒµç¥¨åªæœ‰ä¸€å¼µã€‚
                        // ç‚ºäº†ç°¡åŒ–ï¼Œæˆ‘å€‘å‡è¨­ stamp4 (æ·¡æ°´) å¯ä»¥å°æ‡‰åˆ° tamsui å’Œ dayuan
                        if (draggedStamp.dataset.zhuyin === 'ã„‰' && (zone.id === 'tamsui' || zone.id === 'dayuan')) {
                             infoText.textContent = (zone.id === 'tamsui') 
                                ? "æ–°åŒ—å¸‚æ·¡æ°´å€ï¼Œæ“æœ‰è±å¯Œçš„æ­·å²å¤è¹Ÿå’Œè¿·äººçš„æ·¡æ°´æ²³å²¸æ™¯è§€ã€‚" 
                                : "æ¡ƒåœ’å¸‚å¤§åœ’å€ï¼Œè‡ºç£çš„åœ‹å®¶é–€æˆ¶â€”æ¡ƒåœ’åœ‹éš›æ©Ÿå ´åè½æ–¼æ­¤ã€‚";
                        } 
                        // ä¸­å±±ã€ç«¹åŒ—ã€ç«¹å—çš„æ³¨éŸ³éƒ½æ˜¯ 'ã„“'
                        else if (draggedStamp.dataset.zhuyin === 'ã„“' && (zone.id === 'zhongshan' || zone.id === 'zhubei' || zone.id === 'zhunan')) {
                            if (zone.id === 'zhongshan') infoText.textContent = "è‡ºåŒ—å¸‚ä¸­å±±å€ï¼Œå•†æ¥­æ´»å‹•é »ç¹ï¼Œæ“æœ‰è¨±å¤šé‡‘èæ©Ÿæ§‹å’Œç™¾è²¨å…¬å¸ã€‚";
                            if (zone.id === 'zhubei') infoText.textContent = "æ–°ç«¹ç¸£ç«¹åŒ—å¸‚ï¼Œæ˜¯æ–°ç«¹ç¸£çš„è¡Œæ”¿ä¸­å¿ƒï¼Œé«˜éµæ–°ç«¹ç«™ä¹Ÿä½æ–¼æ­¤ã€‚";
                            if (zone.id === 'zhunan') infoText.textContent = "è‹—æ —ç¸£ç«¹å—é®ï¼Œæ˜¯è‹—æ —çš„äº¤é€šæ¨ç´ä¹‹ä¸€ï¼Œæ“æœ‰ç«¹å—ç§‘å­¸åœ’å€ã€‚";
                        }
                        else {
                            infoText.textContent = draggedStamp.dataset.info;
                        }
                        infoText.parentElement.classList.remove('bg-red-50', 'border-red-200');
                        infoText.classList.remove('text-red-800');
                    } else {
                        infoText.textContent = 'ç­”éŒ¯äº†ï¼Œå†è©¦ä¸€æ¬¡ï¼';
                        infoText.parentElement.classList.add('bg-red-50', 'border-red-200');
                        infoText.classList.add('text-red-800');
                    }
                    
                    draggedStamp = null;
                });
            });
            
            checkButton.addEventListener('click', () => {
                let correctCount = 0;
                let incorrectCount = 0;
                let totalPlaced = 0;
                
                dropZones.forEach(zone => {
                    zone.classList.remove('correct', 'incorrect');
                    const placedStamp = zone.querySelector('.stamp');
                    if (placedStamp) {
                        totalPlaced++;
                        const isCorrect = placedStamp.dataset.zhuyin === zone.dataset.answer;
                        if (isCorrect) {
                            zone.classList.add('correct');
                            correctCount++;
                        } else {
                            zone.classList.add('incorrect');
                            incorrectCount++;
                        }
                    }
                });
                
                if (totalPlaced === 0) {
                    resultMessage.textContent = 'è«‹å…ˆæ‹–æ›³éƒµç¥¨é€²è¡Œé…å°ï¼';
                    resultMessage.className = 'text-lg font-bold text-yellow-600';
                    correctCounter.textContent = '';
                    incorrectCounter.textContent = '';
                    return;
                }

                // æ›´æ–°è¨ˆæ•¸å™¨é¡¯ç¤º
                correctCounter.textContent = `ç­”å°: ${correctCount}`;
                incorrectCounter.textContent = `ç­”éŒ¯: ${incorrectCount}`;

                resultMessage.textContent = `ç­”å°äº† ${correctCount} / ${dropZones.length} é¡Œï¼`;
                if (correctCount === dropZones.length) {
                    resultMessage.textContent += " ğŸ‰";
                    resultMessage.className = 'text-lg font-bold text-green-600';
                } else {
                    resultMessage.className = 'text-lg font-bold text-red-600';
                }
            });

            resetButton.addEventListener('click', () => {
                dropZones.forEach(zone => {
                    zone.classList.remove('correct', 'incorrect');
                    const placedStamp = zone.querySelector('.stamp');
                    if (placedStamp) {
                        stampCollection.appendChild(placedStamp);
                    }
                });
                resultMessage.textContent = '';
                resultMessage.className = 'text-lg font-bold';
                // é‡è¨­è¨ˆæ•¸å™¨å’Œè³‡è¨Šæ¬„
                correctCounter.textContent = '';
                incorrectCounter.textContent = '';
                infoText.textContent = '';
                infoText.parentElement.classList.remove('bg-red-50', 'border-red-200');
                infoText.classList.remove('text-red-800');
            });

            // --- ä½ç½®æ ¡æ­£é‚è¼¯ ---
            const updateCoordsDisplay = (zone) => {
                const top = parseFloat(zone.style.top).toFixed(1);
                const left = parseFloat(zone.style.left).toFixed(1);
                zone.querySelector('.coords').textContent = `T:${top}%, L:${left}%`;
            };

            correctionToggleButton.addEventListener('click', () => {
                isCorrectionMode = !isCorrectionMode; // åˆ‡æ›æ¨¡å¼
                if (isCorrectionMode) {
                    // é€²å…¥æ ¡æ­£æ¨¡å¼
                    gameContainer.classList.add('correction-mode');
                    correctionToggleButton.textContent = 'é—œé–‰æ ¡æ­£æ¨¡å¼';
                    correctionToggleButton.classList.remove('bg-purple-600', 'hover:bg-purple-700');
                    correctionToggleButton.classList.add('bg-orange-500', 'hover:bg-orange-600');
                    dropZones.forEach(zone => {
                        updateCoordsDisplay(zone);
                    });
                } else {
                    // é€€å‡ºæ ¡æ­£æ¨¡å¼
                    gameContainer.classList.remove('correction-mode');
                    correctionToggleButton.textContent = 'é–‹å•Ÿæ ¡æ­£æ¨¡å¼';
                    correctionToggleButton.classList.remove('bg-orange-500', 'hover:bg-orange-600');
                    correctionToggleButton.classList.add('bg-purple-600', 'hover:bg-purple-700');
                    exportPositions();
                }
            });

            dropZones.forEach(zone => {
                zone.addEventListener('mousedown', (e) => {
                    if (!isCorrectionMode) return;
                    e.preventDefault();
                    activeZone = zone;
                    const rect = activeZone.getBoundingClientRect();
                    const mapRect = mapArea.getBoundingClientRect();
                    offsetX = e.clientX - rect.left + mapRect.left;
                    offsetY = e.clientY - rect.top + mapRect.top;
                });
            });

            mapArea.addEventListener('mousemove', (e) => {
                if (!activeZone) return;
                e.preventDefault();
                const mapRect = mapArea.getBoundingClientRect();
                let x = e.clientX - mapRect.left;
                let y = e.clientY - mapRect.top;
                let newLeft = ((x - (offsetX - mapRect.left)) / mapRect.width) * 100;
                let newTop = ((y - (offsetY - mapRect.top)) / mapRect.height) * 100;
                newLeft = Math.max(0, Math.min(100, newLeft));
                newTop = Math.max(0, Math.min(100, newTop));
                activeZone.style.left = `${newLeft}%`;
                activeZone.style.top = `${newTop}%`;
                updateCoordsDisplay(activeZone);
            });

            window.addEventListener('mouseup', () => {
                activeZone = null;
            });

            const exportPositions = () => {
                console.clear();
                console.log("/* --- æ–°çš„è™›ç·šæ¡†ä½ç½® (è«‹è¤‡è£½è²¼åˆ° CSS ä¸­) --- */");
                let cssOutput = "";
                dropZones.forEach(zone => {
                    const id = zone.id;
                    const top = parseFloat(zone.style.top).toFixed(1);
                    const left = parseFloat(zone.style.left).toFixed(1);
                    cssOutput += `#${id}    { top: ${top}%; left: ${left}%; }\n`;
                });
                console.log(cssOutput);
            };
        });
    </script>

</body>
</html>
